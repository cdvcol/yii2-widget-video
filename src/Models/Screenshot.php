<?php

namespace Cacko\Yii2\Widgets\Video\Models;

use SplFileObject;
use yii\base\Model;
use Yii;

class Screenshot extends Model implements ScreenshotInterface
{

    const DEFAULT_SCREENSHOT = ' data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAYEBAQFBAYFBQYJBgUGCQsIBgYICwwKCgsKCgwQDAwMDAwMEAwODxAPDgwTExQUExMcGxsbHCAgICAgICAgICD/2wBDAQcHBw0MDRgQEBgaFREVGiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICD/wgARCAEvAhoDAREAAhEBAxEB/8QAGwABAQEBAQEBAQAAAAAAAAAAAAUEBgMCAQf/2gAIAQEAAAAA/tgAAAAAAAAAAAAAAAAAAAAAAN+9Bb96C370Fv3oLfvQW/egt+9Bb96C370Fv3oLfvQW/egt+9BC9fcEvX3BL19wS9fcEvX3BL19wS9fcEvX3BL19wS9fcEvX3BL19wS9fcEF6+4JevuCXr7gl6+4JevuCXr7gl6+4JevuCXr7gl6+4JevuCXr7gl6+4IL19wS9fcEvX3BL19wS9fcEvX3BL19wS9fcEvX3BL19wS9fcEvX3BL19wQe+hge+hge+hge+hge+hge+hge+hge+hge+hge+hge+hge+hge+hgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD6PkAAAAAAAAANNvX7enoHx5+OePPAAAAAAAAGnsPQABzEkAAAAAAAA6auAAeHEgAAAAAAAHZax55toA4fyAAAAAAAAd19iFz+3oKADj8QAAAAAAAH33Qc7EKnR+wOVmAAAAAAAAe3bhzcYenTUw5iSAAAAAAAB79sHMyAdRVHNRwAAAAAAAPftg5qOGrq9A5qOAAAAAAAB69wHORRY6L7Dl5QAAAAAAAH73gc/Ca+ioAcnOAAAAAAAAdv7CXDtVf0BxmUAAAAAAAB128AA/OF+QAAAAAAAFzoQACdyYAAAAAAAB+9TTAAzcl4AAAAAAAABs1e3p6fR+efn5Z8H4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABr2JDXsSGvYkNexIa9iQ17Ehr2JDXsSGvYkNexIa9iQ17Ehr2JAXr7gl6+4JevuCXr7gl6+4JevuCXr7gl6+4JevuCXr7gl6+4JevuCXr7ggvX3BL19wS9fcEvX3BL19wS9fcEvX3BL19wS9fcEvX3BL19wS9fcEvX3BBevuCXr7gl6+4JevuCXr7gl6+4JevuCXr7gl6+4JevuCXr7gl6+4JevuCDXsSGvYkNexIa9iQ17Ehr2JDXsSGvYkNexIa9iQ17Ehr2JDXsSAAAAAAAAAAAAAAAAAAAAAAAP//EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oACAEDEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/8QATBAAAAIECAkICAMHAwUAAAAAAQIDBBESAAUGExYgUYIQMUFEUpGiwtIVISNCU2TR4hQiMDJQYXHBJKGxNEBiY3CBsjNzkkNygOHw/9oACAEBAAE/AP6FRVFXp870s3Nu9V5rzfmFkKLd62PNCi3etjzYYqir0+d6Wbm3eq815vzCyFFu9bHmhRbvWx5sMVRV6fO9LNzbvVea835hZCi3etjzQot3rY82GKoq9Pnelm5t3qvNeb8wshRbvWx5oUW71sebDFUVenzvSzc271XmvN+YWQot3rY80KLd62PNhiqKvT53pZubd6rzXm/MLIUW71seaFFu9bHmwxVFXp870s3Nu9V5rzfmFkKLd62PNCi3etjzYYqir0+d6Wbm3eq815vzCyFFu9bHmhRbvWx5sMVRV6fO9LNzbvVea835hZCi3etjzQot3rY82GKoq9Pnelm5t3qvNeb8wshRbvWx5oUW71sebDFUVenzvSzc271XmvN+YWQot3rY80KLd62PNhiqKvT53pZubd6rzXm/MLIUW71seaFFu9bHmwxVFXp870s3Nu9V5rzfmFkKLd62PNCi3etjzVpLZ1c3qsls6ub1WS2dXN6rJbOrm9VktnVzeqyWzq5vVZLZ1c3qsls6ub1WS2dXN6rJbOrm9VktnVzeqyWzq5vVZLZ1c3vYSWzq5vVZLZ1c3qsls6ub1WS2dXN6rJbOrm9VktnVzeqyWzq5vVZLZ1c3qsls6ub1WS2dXN6rJbOrm9VktnVzeqyWzq5vewktnVzeqyWzq5vVZLZ1c3qsls6ub1WS2dXN6rJbOrm9VktnVzeqyWzq5vVZLZ1c3qsls6ub1WS2dXN6rJbOrm9VktnVze9gqr60qvTB3H2PcwDixY22w5djXt9knhDl2Ne32SeGFVX1pVemDuPse5gHFixtthy7Gvb7JPCHLsa9vsk8MKqvrSq9MHcfY9zAOLFjbbDl2Ne32SeEOXY17fZJ4YVVfWlV6YO4+x7mAcWLG22HLsa9vsk8Icuxr2+yTwwqq+tKr0wdx9j3MA4sWNtsOXY17fZJ4Q5djXt9knhhVV9aVXpg7j7HuYBxYsbbYcuxr2+yTwhy7Gvb7JPDCqr60qvTB3H2PcwDixY22w5djXt9knhDl2Ne32SeGFVX1pVemDuPse5gHFixtthy7Gvb7JPCHLsa9vsk8MKqvrSq9MHcfY9zAOLFjbbDl2Ne32SeEOXY17fZJ4YVVfWlV6YO4+x7mAcWLG22HLsa9vsk8Icuxr2+yTwwqq+tKr0wdx9j3MA4sWNtsOXY17fZJ4Q5djXt9knhhVV9aVXpg7j7HuYBxYsbbYcuxr2+yTwhy7Gvb7JPDCqr60qvTB3H2PcwDixY22w5djXt9knhDl2Ne32SeH9cJs+iOqE2k0R1Qm0miOqAgIY/jalF6yuHdRF5g944+6EEEmVUodMcyQ3y9UPGBIkisv8A0W/UTD94Fi5QLiV0f/EBgVXQF91GUPoAQAADFzVRQohxkKP9ggZQUTY1dGN0IGiaLDY0Af2aH6QSyci8weo8jH5C39WwX4kWlQBOHSoQ65cn1D4rF6kdcWSog5i4zmsCCBAiQIiokRXSFxB7ePYsBWSAnQgxCkHnLom8B+KSaVwIpmTdZKb8i/8Atv7gvK4LColRZTF9X65Pz+KRSjci5XD+ADf8uf71VhYQq6IUqYzpAywVo4i9YM6RIw1hvV9mtI5tZSo9E5g1D8TQkcQkJolANQVZUn9RXJkETDqZ44FOOF1VYAGfR9mfnD+1kFGOlRaYVs0l0DfYcvsY5I7GacPm3WAD9/iSEryUhbTAH51pUD0yAP4R/WpF8fLCuwibpkPz94PoMFVbV1pG+hM8GUMofUK8oisjIw6RSj9vt8SUQauq4WpCf5VpT/tSL/s+41VdZTK6QEiEwlMH/wBzwiyOkK2xGk6NYsyG+nhWlMH48nzRB+o/Eov/AG9W/wB0n+QVpTD+ORh/KD/Ia8QL6ZZQHIl9YyJnr2gNuqrKf9rRf7f3H4lF/wC3q3+6T/IK0pw/GIx/l7w1lCLlhcSOowYQPeSDiCCkooVNDNovqYw4xGrKcfxqMP5Yf5D8SVBYtIRsOX9a0qA/EoR/g+9WLZPpUrEi01GjyE6w+EESJGiRgjRlApC4gCtKQWxgHyRgH5j8SKLpgNZzwAWg2rKkPWVzWgYNTPHCpRYtrY9GVhMqQ3MWEXxMqqjDf6ibtByfQMnsI/M2NEgaIFDZb9/iamd9UQn0iFH8qsfqKZZVyGRA8dEIi7lYNkFeJ4wTmYCISBlMk9UPz54KcnlVCwyfpj2D7urLAAAAYAMAMQexjQ78YrA/xiGrm+3xOI0j8WIbStKP9h8P3ARAAERxBjgkOJ0hjjjMIjr+JyaXAKY6qYfe9dH9cofuEeLgK6iYoD0ib1Ch8so6vihDmIYDkFhii0BCEWR0hWigjSiCNYsyG+nh7ZdjBWUyPJTet1UYe8MF1dSracUqT6FLkALPiyCN4wQA6RMLthvW/WBJSr4e8VGb+w+MCyoS9ZAUfoZnjAsqUfWVxD6Gb9ggEp1XKiP+UKTKHZpdReKFJlDQS6i8UKTKGgl1F4oDKdTyIkn5eMBlQhyIDawgaVJ+qrgH1M37BA0pl0fdRow1j94JY9jJIDJ1wP4QAPzxwMYxjCYwiYw4xHnH/wALlCLE68/NGKE2xrzcrbAGyFGV/TRazcMKMr+mi1m4cKhFidefmjFCbY15uVtgDZCjK/potZuGFGV/TRazcOFQixOvPzRihNsa83K2wBshRlf00Ws3DCjK/potZuHCoRYnXn5oxQm2NeblbYA2Qoyv6aLWbhhRlf00Ws3DhUIsTrz80YoTbGvNytsAbIUZX9NFrNwwoyv6aLWbhwqEWJ15+aMUJtjXm5W2ANkKMr+mi1m4YUZX9NFrNw4VCLE68/NGKE2xrzcrbAGyFGV/TRazcMKMr+mi1m4cKhFidefmjFCbY15uVtgDZCjK/potZuGFGV/TRazcOFQixOvPzRihNsa83K2wBshRlf00Ws3DCjK/potZuHCoRYnXn5oxQm2NeblbYA2Qoyv6aLWbhhRlf00Ws3DhUIsTrz80YoTbGvNytsAbIUZX9NFrNwwoyv6aLWbhwqEWJ15+aMUJtjXm5W2ANkKMr+mi1m4YUZX9NFrNw4VCLE68/NGKE2xrzcrbAGyFGV/TRazcMKMr+mi1m4a0ls6ub1WS2dXN6rJbOrm9VktnVzeqyWzq5vVZLZ1c3qsls6ub1WS2dXN6rJbOrm9VktnVzeqyWzq5vVZLZ1c3qsls6ub3sJLZ1c3qsls6ub1WS2dXN6rJbOrm9VktnVzeqyWzq5vVZLZ1c3qsls6ub1WS2dXN6rJbOrm9VktnVzeqyWzq5vVZLZ1c3vYSWzq5vVZLZ1c3qsls6ub1WS2dXN6rJbOrm9VktnVzeqyWzq5vVZLZ1c3qsls6ub1WS2dXN6rJbOrm9VktnVzeqyWzq5vewUIzTqL80UozjGvNyNsELYUmX9BFqNxQpMv6CLUbiwqEZp1F+aKUZxjXm5G2CFsKTL+gi1G4oUmX9BFqNxYVCM06i/NFKM4xrzcjbBC2FJl/QRajcUKTL+gi1G4sKhGadRfmilGcY15uRtghbCky/oItRuKFJl/QRajcWFQjNOovzRSjOMa83I2wQthSZf0EWo3FCky/oItRuLCoRmnUX5opRnGNebkbYIWwpMv6CLUbihSZf0EWo3FhUIzTqL80UozjGvNyNsELYUmX9BFqNxQpMv6CLUbiwqEZp1F+aKUZxjXm5G2CFsKTL+gi1G4oUmX9BFqNxYVCM06i/NFKM4xrzcjbBC2FJl/QRajcUKTL+gi1G4sKhGadRfmilGcY15uRtghbCky/oItRuKFJl/QRajcWFQjNOovzRSjOMa83I2wQthSZf0EWo3FCky/oItRuLCoRmnUX5opRnGNebkbYIWwpMv6CLUbihSZf0EWo3FhUIzTqL80UozjGvNyNsELYUmX9BFqNxQpMv6CLUbi/oZ//xAAUEQEAAAAAAAAAAAAAAAAAAACw/9oACAECAQE/ACGP/8QAFBEBAAAAAAAAAAAAAAAAAAAAsP/aAAgBAwEBPwAhj//Z';

    public string $id = '';

    public string $url = '';

    public function setId(string $id): ScreenshotInterface
    {
        $this->id = $id;
        return $this;
    }

    public function setUrl(string $url): ScreenshotInterface
    {
        $this->url = $url;
        return $this;
    }

    public function getId(): string
    {
        return $this->id;
    }

    public function getUrl(): string
    {
        return $this->url;
    }

    public function save(): bool
    {
        $tmpfile = new SplFileObject(static::getStorageFilename($this->getId()), 'w');
        $tmpfile->fwrite(serialize($this));
        return true;
    }

    public static function findOne($condition): ?ScreenshotInterface
    {
        $key = is_scalar($condition) ? $condition : reset($condition);

        $filename = static::getStorageFilename($key);

        if (!$key || !file_exists($filename)) {
            return null;
        }

        $file = new SplFileObject($filename);

        $screenshot = $file->fread($file->getSize());

        return $screenshot ? unserialize($screenshot) : null;
    }

    protected static function getStorageFilename($id)
    {
        return sys_get_temp_dir() . DIRECTORY_SEPARATOR . $id;
    }
}
